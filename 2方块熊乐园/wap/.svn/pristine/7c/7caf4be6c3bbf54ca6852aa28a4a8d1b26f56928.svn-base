<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<include file="public:meta" />
		<link href="../public/css/company/common.css" rel="stylesheet" type="text/css" />
		<link href="../public/css/company/company_points.css" rel="stylesheet" type="text/css" />
		<script src="../public/js/company/jquery.common.js" type="text/javascript" language="javascript"></script>
	</head>
	<body>
		<include file="Company:index_header" />
		<div class="user_main">
			<div class="mleft">
				<include file="Company:left_service" />
			</div>
			<div class="mright">
				<div class="user_pagetitle">
					<div class="pat_l"> Value-added services </div>
					<div class="clear"></div>
				</div>
				<div class="point_title_group1">
					<div><div class="left_border"></div></div>
					<div class="title_left"> Order Summary </div>
					<div class="title_right link_blue">
						 Order Status ：
						<eq name="order['is_paid']" value="3">
						<span class="grey"> Cancelled </span>  
						<else />
						<span class="grean"> Paid </span>
						</eq>
					</div>
					<div class="clear"></div>
				</div>
				<div class="order_info_group">
					<div class="info_float_line">
						<div class="left_line"> Order number ：{$order['oid']}</div>
						<div class="right_line"> Order Type ：{$order['service_name']}</div>
						<div class="clear"></div>
					</div>
					<div class="info_float_line">
						<div class="left_line"> Create time ：{:date('Y-m-d H:i:s',$order['addtime'])}</div>
						<div class="right_line"> Payment time ：{:date('Y-m-d H:i:s',$order['payment_time'])}</div>
						<div class="clear"></div>
					</div>
					<div class="info_all_line">
						 Payment status ：
						<eq name="order['is_paid']" value="3">
						<span class="grey"> Cancelled </span>  
						<else />
						<span class="grean"> Paid </span>  
						<span class="orange">￥{$order['amount']}</span>
						 = 
						<span class="small">
						<if condition="$order['pay_type'] eq 2">
						（{$order['payment_cn']}：￥{$order['pay_amount']}）
						<elseif condition="$order['pay_type'] eq 1" />
						（{:C('qscms_points_byname')} Pay ：{$order['pay_points']}{:C('qscms_points_byname')}）
						<else />
						（{$order['payment_cn']}：￥{$order['pay_amount']}） + 
						（{:C('qscms_points_byname')} Pay ：{$order['pay_points']}{:C('qscms_points_byname')}）
						</if>
						</span>
						</eq>
					</div>
				</div>
				<div class="point_title_group1">
					<div><div class="left_border"></div></div>
					<div class="title_left"> Order content </div>
					<div class="clear"></div>
				</div>
				<div class="order_info_group">
					<div class="info_float_line line_head">
						<div class="line line1"> Service type </div>
						<div class="line line2"> Service content </div>
						<div class="line line3"> Package offer </div>
						<div class="line line4"> Resource expiration time </div>
						<div class="clear"></div>
					</div>
					<div class="info_float_line">
						<div class="line line1">{$order_type_cn}</div>
						<div class="line line2">{$order['service_name']}</div>
						<div class="line line3"><if condition="$order['discount'] eq ''"> no <else />{$order['discount']}</if></div>
						<div class="line line4">
						<if condition="$order['order_type'] eq 1">
							<eq name="setmeal['endtime']" value="0"> no 期限<else />{:date('Y-m-d',$setmeal['endtime'])}</eq>
						<elseif condition="$order['order_type'] eq 2"/>
							 no 期限
						<else />
							<if condition="$order['is_paid'] eq 1 || $order['is_paid'] eq 3">
							--
							<elseif condition="$order['params']['days']"/>
							{:date('Y-m-d',$order['payment_time']+$order['params']['days']*3600*24)}
							<else />
							--
							</if>
						</if>
						</div>
						<div class="clear"></div>
					</div>
				</div>
				<eq name="open_invoice" value="1">
				<eq name="order['is_paid']" value="2">
				<!--  Paid 头部 -->
				<div class="point_title_group1">
					<div><div class="left_border"></div></div>
					<div class="title_left"> Request an invoice  <span class="small">( The invoice type is a VAT invoice ， Uniform time to send )</span></div>
					<div class="title_right link_blue"><span class="orange small">* {:C('qscms_points_byname')} Pay 部分不可 Request an invoice </span></div>
					<div class="clear"></div>
				</div>
				<if condition="$order['pay_type'] neq 1 && !$invoice">
					<form id="invoice_form">
					<div id="invoice_ajax_wrap">
						<div class="order_info_group">
							<div class="info_float_line1">
								<div class="left_line"> Invoice ：</div>
								<div class="right_line">
									<div class="radio_list fl J_radioitme_parent">
										<div class="rli checked J_radioitme J_title" data-code="1"> unit </div>
										<div class="rli J_radioitme J_title" data-code="2"> personal </div>
										<div class="clear"></div>
										<input type="hidden" class="J_radioitme_code" name="title" id="invoice_title" value="1"/>
									</div>
								</div>
								<div class="clear"></div>
							</div>
						</div>
						<div class="order_info_group">
							<div class="info_float_line1">
								<div class="left_line"> invoice content ：</div>
								<div class="right_line">
									<div class="radio_list fl J_radioitme_parent">
										<input type="hidden" class="J_radioitme_code" name="cid" id="invoice_cid" value="{:key($category)}"/>
										<volist name="category" id="category">
											<div class="rli J_radioitme <if condition="$i eq 1">checked</if>" data-code="{$key}">{$category}</div>
										</volist>
										<div class="clear"></div>
									</div>
								</div>
								<div class="clear"></div>
							</div>
						</div>
						<div class="J_order_info_group order_info_group">
							<div class="info_float_line1">
								<div class="left_line"> unit 名称：</div>
								<div class="right_line"><input type="text" value="{$contact.companyname}" class="input_245_34" id="invoice_organization" name="organization"></div>
								<div class="clear"></div>
							</div>
						</div>
						<div class="J_order_info_group order_info_group">
							<div class="info_float_line1">
								<div class="left_line"> Tax number ：</div>
								<div class="right_line"><input type="text" value="" class="input_245_34" id="invoice_tax_number" name="tax_number"></div>
								<div class="clear"></div>
							</div>
						</div>
						<div class="order_info_group">
							<div class="info_float_line1">
								<div class="left_line"> The recipient ：</div>
								<div class="right_line"><input type="text" value="{$contact.contact}" class="input_245_34" id="invoice_addressee" name="addressee"></div>
								<div class="clear"></div>
							</div>
						</div>
						<div class="order_info_group">
							<div class="info_float_line1">
								<div class="left_line"> phone number ：</div>
								<div class="right_line"><input type="text" value="{$contact.telephone|default=$contact['landline_tel']}" class="input_245_34" id="invoice_mobile" name="mobile"></div>
								<div class="clear"></div>
							</div>
						</div>
						<div class="order_info_group">
							<div class="info_float_line1">
								<div class="left_line"> Mailing address ：</div>
								<div class="right_line"><input type="text" value="{$contact.address}" class="input_245_34" id="invoice_address" name="address"></div>
								<div class="clear"></div>
							</div>
						</div>
						<div class="order_info_group">
							<div class="info_float_line1">
								<div class="left_line"> Zip code ：</div>
								<div class="right_line"><input type="text" value="{$contact.postcode}" class="input_245_34" id="invoice_postcode" name="postcode"></div>
								<div class="clear"></div>
							</div>
						</div>
						<div class="order_info_group">
							<div class="info_float_line1">
								<input type="hidden" name="order_id" value="{$order['id']}">
								<div class="btn_yellow J_hoverbut btn_115_32" id="invoice_submit"> Request an invoice </div>
							</div>
						</div>
					</div>
					</form>
				<elseif condition="$invoice" />
					<div>
						<div class="order_info_group">
							<div class="info_float_line">
								<div class="left_line"> Invoice ： {$invoice['title']}</div>
								<div class="right_line"> invoice content ： {$invoice['cate']}</div>
								<div class="clear"></div>
							</div>
							<div class="info_all_line"> unit 名称： {$invoice['organization']}</div>
							<div class="info_all_line"> Tax number ： {$invoice['tax_number']}</div>
						</div>
						<div class="order_info_group">
							<p class="rem_title"> Invoice mailing </p>
							<div class="info_float_line">
								<div class="left_line"> &nbsp;&nbsp;&nbsp; The recipient ：  {$invoice['addressee']}</div>
								<div class="right_line"> phone number ：  {$invoice['mobile']}</div>
								<div class="clear"></div>
							</div>
							<div class="info_all_line"> Zip code ：  {$invoice['postcode']}</div>
							<div class="info_all_line"> Mailing address ：  {$invoice['address']}</div>
						</div>
					</div>
				</if>
				</eq>
				</eq>
			</div>
			<div class="clear"></div>
		</div>
		<include file="Company:index_footer" />
		<script type="text/javascript">
			$(document).ready(function(){
				$('.J_title').click(function(){
					if($(this).attr('data-code') == 1){
						$('.J_order_info_group').show();
					}else{
						$('.J_order_info_group').hide();
					}
				});
				$("#invoice_submit").click(function(){
					if(!$("#invoice_title").val()){
						disapperTooltip("remind","请选择 Invoice ！");
						return false;
					}
					if(!$("#invoice_cid").val()){
						disapperTooltip("remind","请选择 invoice content ！");
						return false;
					}
					if(!$("#invoice_organization").val() && $("#invoice_title").val()==1){
						disapperTooltip("remind","请填写 unit 名称！");
						return false;
					}
					if(!$("#invoice_tax_number").val() && $("#invoice_title").val()==1){
						disapperTooltip("remind","请填写 Tax number ！");
						return false;
					}
					if(!$("#invoice_addressee").val()){
						disapperTooltip("remind","请填写 The recipient ！");
						return false;
					}
					if(!$("#invoice_mobile").val()){
						disapperTooltip("remind","请填写 phone number ！");
						return false;
					}
					if(!$("#invoice_address").val()){
						disapperTooltip("remind","请填写 Mailing address ！");
						return false;
					}
					if(!$("#invoice_postcode").val()){
						disapperTooltip("remind","请填写 Zip code ！");
						return false;
					}
					$.ajax({
		                cache: true,
		                type: "POST",
		                url:"{:U('invoice_save')}",
		                data:$('#invoice_form').serialize(),
		                async: false,
		                dataType:"json",
		                success: function(result) {
		                    if(result.status==1){
		                    	disapperTooltip("success"," Request an invoice 成功！");
		                    	var html = '<div class="order_info_group"><div class="info_float_line">';
		                    	html += '<div class="left_line"> Invoice ： '+result.data.title+'</div>';
		                    	html += '<div class="right_line"> invoice content ： '+result.data.cate+'</div>';
		                    	html += '<div class="clear"></div></div>';
		                    	html += '<div class="info_all_line"> unit 名称： '+result.data.organization+'</div>';
		                    	html += '<div class="info_all_line"> Tax number ： '+result.data.tax_number+'</div>';
		                    	html += '</div>';
		                    	html += '<div class="order_info_group"><p class="rem_title"> Invoice mailing </p>';
		                    	html += '<div class="info_float_line">';
		                    	html += '<div class="left_line"> &nbsp;&nbsp;&nbsp; The recipient ：  '+result.data.addressee+'</div>';
		                    	html += '<div class="right_line"> phone number ：  '+result.data.mobile+'</div>';
		                    	html += '<div class="clear"></div></div>';
		                    	html += '<div class="info_all_line"> Zip code ：  '+result.data.postcode+'</div>';
		                    	html += '<div class="info_all_line"> Mailing address ：  '+result.data.address+'</div></div>';
								$("#invoice_ajax_wrap").html(html);
		                    }else{
		                    	disapperTooltip("remind",result.msg);
								return false;
		                    }
		                }
		            });
				});
			});
		</script>
	</body>
</html>