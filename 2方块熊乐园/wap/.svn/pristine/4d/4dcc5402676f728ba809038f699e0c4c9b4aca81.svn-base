<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <include file="public:meta" />
    <link href="../public/css/common.css" rel="stylesheet" type="text/css" />
    <link href="../public/css/suggest.css" rel="stylesheet" type="text/css" />
    <qscms:load type="category"/>
</head>
<body>
<include file="public:header" />
<div class="all_body">
    <div class="suggest_main">
        <div class="suggest_head"> Your advice makes us better every day </div>
        <div class="top_tips"> Hello users ， Please take your opinion 、 idea 、 Suggestions or complaints tell us ， To help us for all users to provide more quality services 。 We will be the first time in time to reply to your feedback ， If your problem is more urgent ， Please call the service hotline ：{:C('qscms_bootom_tel')}。</div>
        <div class="suggest_list_group">
            <div class="suggest_list_cell">
                <div class="list_cell_left"> Type of opinion </div>
                <div class="list_cell_right">
                    <div class="suggest_type_cell"><div class="suggest_type selected" data-code="1"> Suggest </div></div>
                    <div class="suggest_type_cell"><div class="suggest_type" data-code="2"> opinion </div></div>
                    <div class="suggest_type_cell"><div class="suggest_type" data-code="3"> Help </div></div>
                    <div class="suggest_type_cell"><div class="suggest_type" data-code="4"> Complaints </div></div>
                    <div class="clear"></div>
                    <input type="hidden" name="infotype" value="1"  />
                </div>
                <div class="clear"></div>
            </div>
            <div class="suggest_list_cell">
                <div class="list_cell_left"> Contact information </div>
                <div class="list_cell_right"><input type="text" class="suggest_input" name="tel" placeholder=" Please enter your QQ、 Mail or phone to communicate with you ， Your information is visible only to the staff ！"></div>
                <div class="clear"></div>
            </div>
            <div class="suggest_list_cell">
                <div class="list_cell_left"> Feedback content </div>
                <div class="list_cell_right">
                    <textarea class="suggest_area" id="suggest_feedback" name="feedback" placeholder=" Please describe in detail the problem you are experiencing ， Help us to quickly locate and solve the problem "></textarea>
                </div>
                <div class="clear"></div>
            </div>
            <div class="suggest_list_cell">
                <div class="list_cell_left"></div>
                <div class="list_cell_right">
                    <input type="button" class="btn_yellow suggest_btn" id="J_suggest_submit" value=" mention   cross " />
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" id="J_suggest_verify" value="{$varify_suggest}" />
<input type="button" id="btnCheck" style="display:none;">
<div id="popup-captcha"></div>
<include file="public:footer_min" />
<script src="http://static.geetest.com/static/tools/gt.js"></script>
<script type="text/javascript">
    //  Type of opinion 切换
    $('.suggest_type').click(function(event) {
        $('.suggest_type').each(function(index, el) {
            $(this).removeClass('selected');
        });
        $(this).addClass('selected');
        $('input[name="infotype"]').val($(this).data('code'));
    });
    //  mention  cross 验证
    $('#J_suggest_submit').die().live('click', function(event) {
        var typeValue = $.trim($('input[name="infotype"]').val());
        var telValue = $.trim($('input[name="tel"]').val());
        var feedbackValue = $.trim($('#suggest_feedback').val());
        if (typeValue == "") {
            disapperTooltip("remind", "请选择 Type of opinion ");
            return false;
        }
        if (telValue == "") {
            disapperTooltip("remind", "请填写 Contact information ");
            return false;
        }
        if (telValue != "" && telValue.length > 30) {
            disapperTooltip("remind", " Contact information 不能超出30 The word ");
            return false;
        }
        if (feedbackValue == "") {
            disapperTooltip("remind", "请填写 Feedback content ");
            return false;
        }
        if (eval($('#J_suggest_verify').val())) {console.log(' Experience ');
            $("#btnCheck").click();
        } else {
            $('#J_suggest_submit').val(' mention   cross   in ...').addClass('btn_disabled').prop('disabled', !0);
            doSuggestFun();
        }
    });

    function doSuggestFun() {
        var typeValue = $.trim($('input[name="infotype"]').val());
        var telValue = $.trim($('input[name="tel"]').val());
        var feedbackValue = $.trim($('#suggest_feedback').val());
        //  mention  cross 表单
        $.ajax({
            url: "{:U('Suggest/index')}",
            type: 'POST',
            dataType: 'json',
            data: {infotype: typeValue, tel: telValue, feedback: feedbackValue}
        })
        .done(function(data) {
            if (parseInt(data.status)) {
                disapperTooltip("success", data.msg);
                setTimeout(function () {
                    window.location.reload();
                }, 2000);
            } else {
                $('#J_suggest_submit').val(' mention   cross ').removeClass('btn_disabled').prop('disabled', 0);
                disapperTooltip("remind", data.msg);
            }
        })
        .fail(function(result) {
            $('#J_suggest_submit').val(' mention   cross ').removeClass('btn_disabled').prop('disabled', 0);
            disapperTooltip("remind", result.msg);
        });
    }
    if (eval($('#J_suggest_verify').val())) {console.log(eval($('#J_suggest_verify').val()));
        $.ajax({
            //  Obtain id，challenge，success（ Whether to enable failback）
            url: qscms.root+'?m=Home&c=Captcha&t=' + (new Date()).getTime(), //  Plus random number to prevent caching 
            type: "get",
            dataType: "json",
            success: function (data) {
                //  use initGeetest interface 
                //  parameter 1：配置 parameter 
                //  parameter 2： Callback ， Callback 的第一个 parameter 验证码对象，之后可以 use 它做appendTo Such as the event 
                initGeetest({
                    gt: data.gt,
                    challenge: data.challenge,
                    product: "popup", //  Product form ， include ：float，embed，popup。 Note only right PC Verification code is valid 
                    offline: !data.success // 表示用户后台检测 Experience 服务器是否宕机， Generally do not need attention 
                }, handler);
            }
        });
        var handler = function(captchaObj) {
            captchaObj.appendTo("#popup-captcha");
            captchaObj.bindOn("#btnCheck");
            captchaObj.onSuccess(function() {
                $('#J_suggest_submit').val(' mention   cross   in ...').addClass('btn_disabled').prop('disabled', !0);
                doSuggestFun();
            });
            captchaObj.onFail(function() {
                $('#J_suggest_submit').val(' mention   cross ').removeClass('btn_disabled').prop('disabled', 0);
            });
            captchaObj.onError(function() {
                $('#J_suggest_submit').val(' mention   cross ').removeClass('btn_disabled').prop('disabled', 0);
            });
            captchaObj.getValidate()
        };
    }
</script>
</body>
</html>