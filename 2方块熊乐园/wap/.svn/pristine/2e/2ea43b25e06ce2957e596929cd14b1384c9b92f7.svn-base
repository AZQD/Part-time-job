<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<include file="public:meta" />
		<link href="../public/css/company/common.css" rel="stylesheet" type="text/css" />
		<link href="../public/css/company/company_jobs.css" rel="stylesheet" type="text/css" />
		<link href="../public/css/company/company_ajax_dialog.css" rel="stylesheet" type="text/css" />
		<script src="../public/js/company/jquery.common.js" type="text/javascript" language="javascript"></script>
	</head>
	<body>
		<include file="index_header" />
		<div class="user_main">
			<div class="mleft">
				<include file="left_jobs" />
			</div>
			<div class="mright">
				<div class="user_pagetitle">
					<div class="pat_l">管理职位</div>
					<div class="clear"></div>
				</div>
				<div class="user_tab mt15">
					<a href="{:U('company/jobs_list')}" class="tabli <if condition="$Think.get.type eq ''">select</if>">All Jobs</a>
					<a href="{:U('company/jobs_list',array('type'=>1))}" class="tabli <if condition="$Think.get.type eq 1">select</if>">Published</a>
					<a href="{:U('company/jobs_list',array('type'=>2))}" class="tabli <if condition="$Think.get.type eq 2">select</if>">Unpublished</a>
					<div class="clear"></div>
					<if condition="$upper_limit eq 1">
					<div class="btnbox"><div class="btn_yellow J_hoverbut btn_add J_addJobsDig" href="javascript:;">New Job</div></div>
					<else />
					<div class="btnbox"><div class="btn_yellow J_hoverbut btn_add" onclick="window.location='{:U('jobs_add')}'">New Job</div></div>
					</if>
				</div>
				<!--div class="user_tip w680">
					<div class="tiptit">TIPS</div>
					<div class="tiptxt link_blue">
					Dear HR, you can publish {$total} jobs and {$setmeal.jobs_meanwhile} jobs have been published.
					</div>
				</div-->
				<notempty name="jobs_list['list']">
				<form id="form1" action="{:U('jobs_perform')}" class="J_allListBox" method="post">
					<div class="jobsWrap">
						<volist name="jobs_list['list']" id="jobs">
							<div class="jobsList">
								<div class="selWrap">
									<input name="y_id[]" class="selStatus J_allList" type="checkbox" value="{$jobs['id']}">
								</div>
								<div class="jobs fl">
									<div class="title">
										<a target="_blank" href="{$jobs.jobs_url}" class="">{$jobs.jobs_name}</a>
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$jobs.district_cn}
									</div>
									<div class="update">
										In Review:
										<a href="{:U('company/jobs_apply',array('jobs_id'=>$jobs['id']))}" class="">{$jobs.applys}</a>
										&nbsp;&nbsp; | &nbsp;&nbsp;Update Time:{:date('Y-m-d H:i',$jobs['refreshtime'])}
										<a href="javascript:;" class="jobs_refresh" data-type="0" url="{:U('CompanyService/jobs_refresh',array('yid'=>$jobs['id']))}">[刷新]</a>
									</div>
									<div class="J_operation btns">
										<a href="{:U('jobs_edit',array('id'=>$jobs['id']))}">Edit</a>
										<!-- <a href="{:url_rewrite('QS_resumelist',array('jobcategory'=>$jobs['jobcategory']))}"  target="_blank">匹配</a> -->
										<a href="javascript:;" url="{:U('jobs_close',array('y_id'=>$jobs['id'],'list_type'=>$_GET['type']))}" class="close">Close</a>
										<a href="javascript:;" url="{:U('jobs_delete',array('y_id'=>$jobs['id'],'list_type'=>$_GET['type']))}" class="delete">Delete</a>
										<a href="javascript:;" class="friend" url="{:urlencode(build_mobile_url(array('c'=>'Wzp','a'=>'com','params'=>'id='.$jobs["company_id"])))}">Share</a>
									</div>
								</div>
								<div class="clear"></div>
							</div>
						</volist>
					</div>
					<div class="jobsWrap">
						<div class="allSelWrap">
							<input name="" class="allSel J_allSelected" type="checkbox">
						</div>
						<div class="btn_blue J_hoverbut btn_inline" id="refresh_all" >刷新职位</div>
						<div class="btn_blue J_hoverbut btn_inline" id="close_all">关闭职位</div>
						<div class="btn_lightgray J_hoverbut btn_inline btn_border" id="delete_all">删除职位</div>
						<div class="qspage">{$jobs_list.page}</div>
						<div class="clear"></div>
					</div>
				</form>
				<else/>
					<div class="jobsWrap">
						<div class="res_empty">
							亲爱的HR，您还没有显示中的职位，若已发布，请您查看审核中的职位<br>
							想要快速找到合适的人才，就赶紧发布职位招揽人才吧~
						</div>
						<div class="res_empty_addbox">
							<div class="btn_blue J_hoverbut btn_115_38" onclick="window.location='{:U('jobs_add')}'">发布职位>></div>
						</div>
					</div>
				</notempty>
			</div>
			<div class="clear"></div>
		</div>
		<include file="index_footer" />
		<script type="text/javascript" src="../public/js/jquery.allselected.js"></script>
		<script type="text/javascript">
			$(document).ready(function(){
				$("#delete_all").click(function(){
					var listCheckedArray = $('.J_allListBox .J_allList:checked');
					if (!listCheckedArray.length) {
						disapperTooltip("remind",'请选择职位');
						return false;
					}
					var url = "{:U('jobs_delete')}";
		            var qsDialog = $(this).dialog({
		                title: '删除职位',
		                loading: true,
		                border: false,
		                yes: function () {
		                    $("#form1").attr('action',"{:U('jobs_delete')}");
							$("#form1").submit();
		                }
		            });
		            $.getJSON(url, function (result) {
		                if (result.status == 1) {
		                    qsDialog.setContent(result.data.html);
		                } else {
		                    disapperTooltip('remind', result.msg);
		                }
		            });
				});
				$("#refresh_all").click(function(){
					var listCheckedArray = $('.J_allListBox .J_allList:checked');
					if (!listCheckedArray.length) {
						disapperTooltip("remind",'请选择职位');
						return false;
					}
					var checkedValArr = [];
					$.each(listCheckedArray, function(index, val) {
						checkedValArr[index] = $(this).val();
					});
					var url = "{:U('CompanyService/jobs_refresh')}";
					var yid = checkedValArr.join(',');
					var qsDialog = $(this).dialog({
		        		title: '职位刷新',
		        		loading:true,
						showFooter: false,
						yes:function(){
							$.post(url,{yid:yid},function(result){
								if(result.status){
									disapperTooltip("success",result.msg);
                					setTimeout(function () {
				                        window.location.reload();
				                    }, 2000);
								}else{
					                disapperTooltip("remind",result.msg);
					                return false;
					            }
							},'json');
						}
					});
					$.getJSON(url,{yid:yid},function(result){
						if(result.status==2){
							qsDialog.hide();
		        			var son_qsDialog = $(this).dialog({
				                title: '批量刷新职位',
				                loading: true,
				                border: false
				            });
				            son_qsDialog.setBtns(['单条刷新', '取消']);
				            son_qsDialog.setContent('<div class="refresh_jobs_all_confirm">' + result.msg + '</div>');
						}else{
							if(result.data.show_footer==0){
								qsDialog.showFooter(false);
							}else{
								qsDialog.showFooter(true);
							}
							if(result.status==0){
								qsDialog.showFooter(false);
							}
							qsDialog.setContent(result.msg);
						}
					});
				});
				$("#close_all").click(function(){
					var listCheckedArray = $('.J_allListBox .J_allList:checked');
					if (!listCheckedArray.length) {
						disapperTooltip("remind",'请选择职位');
						return false;
					}
					var url = "{:U('jobs_close')}";
		            var qsDialog = $(this).dialog({
		                title: '关闭职位',
		                loading: true,
		                border: false,
		                yes: function () {
		                    $("#form1").attr('action',"{:U('jobs_close')}");
							$("#form1").submit();
		                }
		            });
		            $.getJSON(url, function (result) {
		                if (result.status == 1) {
		                    qsDialog.setContent(result.data.html);
		                } else {
		                    disapperTooltip('remind', result.msg);
		                }
		            });
				});
				$(".close").click(function(){
					var url = $(this).attr('url');
		            var qsDialog = $(this).dialog({
		                title: '关闭职位',
		                loading: true,
		                border: false,
		                yes: function () {
		                    $.post(url, function (result) {
				                if (result.status == 1) {
				                	disapperTooltip("success",result.msg);
				                	setTimeout(function () {
				                        location.href=result.data;
				                    }, 2000);
				                } else {
				                    disapperTooltip('remind', result.msg);
				                }
				            },'json');
		                }
		            });
		            $.getJSON(url, function (result) {
		                if (result.status == 1) {
		                    qsDialog.setContent(result.data.html);
		                } else {
		                    disapperTooltip('remind', result.msg);
		                }
		            });
				});
				$(".delete").click(function(){
					var url = $(this).attr('url');
		            var qsDialog = $(this).dialog({
		                title: '删除职位',
		                loading: true,
		                border: false,
		                yes: function () {
		                    $.post(url, function (result) {
				                if (result.status == 1) {
				                	disapperTooltip("success",result.msg);
				                    setTimeout(function () {
				                        location.href=result.data;
				                    }, 2000);
				                } else {
				                    disapperTooltip('remind', result.msg);
				                }
				            },'json');
		                }
		            });
		            $.getJSON(url, function (result) {
		                if (result.status == 1) {
		                    qsDialog.setContent(result.data.html);
		                } else {
		                    disapperTooltip('remind', result.msg);
		                }
		            });
				});
				// 分享到朋友圈
				$(".friend").click(function(){
					var qsDialog = $(this).dialog({
		        		loading: true,
						footer: false,
						header: false,
						border: false,
						backdrop: false
					});
					var url = $(this).attr('url');
					qsDialog.hide();
					var qsDialogSon = $(this).dialog({
		        		title: '分享到朋友圈',
		        		content: '<img width="200" height="200" src="{:C("qscms_site_dir")}index.php?m=Home&c=Qrcode&a=index&url='+url+'" />',
						footer: false
					});
				});
				$(".jobs_refresh").click(function(){
					var url = $(this).attr('url');
					var footerShow = eval($(this).data('type'));
					var qsDialog = $(this).dialog({
		        		title: '职位刷新',
		        		loading:true,
						showFooter: false,
						yes:function(){
							$.post(url,function(result){
								if(result.status){
									disapperTooltip("success",result.msg);
                					setTimeout(function () {
				                        window.location.reload();
				                    }, 2000);
								}else{
					                disapperTooltip("remind",result.msg);
					                return false;
					            }
							},'json');
						}
					});
					$.getJSON(url,function(result){
						if(result.data.show_footer==0){
							qsDialog.showFooter(false);
						}else{
							if (!footerShow) {
								qsDialog.showFooter(true);
							}
						}
						qsDialog.setContent(result.msg);
					});
				});
				$(".stick_btn").click(function(){
					var qsDialog = $(this).dialog({
		        		title: '职位置顶',
		        		loading:true,
						showFooter: false
					});
					var url = "{:U('CompanyService/jobs_stick')}";
					var jobs_id = $(this).attr('data');
					$.getJSON(url,{jobs_id:jobs_id},function(result){
						qsDialog.setContent(result.msg);
					});
				});
				$(".emergency_btn").click(function(){
					var qsDialog = $(this).dialog({
		        		title: '职位紧急',
		        		loading:true,
						showFooter: false
					});
					var url = "{:U('CompanyService/jobs_emergency')}";
					var jobs_id = $(this).attr('data');
					$.getJSON(url,{jobs_id:jobs_id},function(result){
						qsDialog.setContent(result.msg);
					});
				});
			});
		</script>
	</body>
</html>