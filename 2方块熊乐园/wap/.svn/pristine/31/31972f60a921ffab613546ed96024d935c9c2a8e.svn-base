<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<include file="public:meta" />
		<link href="../public/css/company/common.css" rel="stylesheet" type="text/css" />
		<link href="../public/css/company/company_points.css" rel="stylesheet" type="text/css" />
		<link href="../public/css/company/company_ajax_dialog.css" rel="stylesheet" type="text/css" />
		<script src="../public/js/company/jquery.common.js" type="text/javascript" language="javascript"></script>
	</head>
	<body>
		<include file="Company:index_header" />
		<div class="user_main">
			<div class="mleft">
				<include file="Company:left_service" />
			</div>
			<div class="mright">
			
				<form target="_blank" id="cash_pay_form" method="post" action="{:U('famouns_add_save')}">
				<div class="user_pagetitle">
					<div class="pat_l"> Value-added services </div>
					<div class="clear"></div>
				</div>
				<div class="user_tip">
					<div class="tiptit"> hint </div>
					<div class="tiptxt link_blue">
					 Opened  <strong> Recruitment </strong>  Rear ， You can apply for a refund at any time ，退还 Rear 将不再享受 <strong> Recruitment </strong>  All the recruitment privileges ；<br />

 Recruitment process ， If you have to pay a deposit and other irregularities to job seekers ( Or illegal ) behavior ，并经调查 Rear 情况属实， We will deduct a certain amount of your deposit first paid to job seekers 。
					</div>
				</div>
				<div class="order_info_group first">
					<div class="info_float_line1">
						<div class="left_line"> service name ：</div>
						<div class="right_line"><span class="service_title"> Recruitment </span></div>
						<div class="clear"></div>
					</div>
				</div>
				<div class="order_info_group">
					<div class="info_float_line1">
						<div class="left_line"> payment method ：</div>
						<div class="right_line">
							<div class="rights J_forpaycash">
								<!--默认是不做任何 select  没有select -->
								<volist name="payment" id="vo">
								<div typename="{$vo['typename']}" class="pays J_hoverbut"><img src="../public/images/pay_{$vo['typename']}.png"   border="0"/><div class="hook"></div></div>
								</volist>
								<div class="clear"></div>	
						  	</div>
						</div>
						<div class="clear"></div>
					</div>
				</div>
				<div class="forpay">
					<div class="order_info_group">
						<div class="info_float_line1">
							<div class="left_line"> Margin ：</div>
							<div class="right_line link_blue">
								<div><span class="service_title"><span class="orange" id="pay_cash">{$amount}</span></span>  yuan </div>
							</div>
							<div class="clear"></div>
						</div>
					</div>
					<div class="order_info_group">
						<div class="info_float_line1">
							<div class="btn_yellow J_hoverbut btn_115_38" id="submit"> Buy now </div>
						</div>
					</div>
				</div>
				<!-- payment method 名称-->
				<input type="hidden" name="payment_name" id="payment_name" value="">
			</form>
			</div>

			<div class="clear"></div>
		</div>
		<include file="Company:index_footer" />
		<script type="text/javascript">
		$(document).ready(function(){
			// select payment
			$(".pays").click(function(){
				$(this).siblings().removeClass('select');
				$(this).addClass('select');
				$("#payment_name").val($(this).attr("typename"));
			});
			// Cash payment submission 
		    $("#submit").click(function(){
				if(!$("#payment_name").val()){
					disapperTooltip("remind","请 select  payment method ！");
					return false;
				}
				if($("#payment_name").val()=='wxpay'){
					var qsDialog = $(this).dialog({
		        		title: ' WeChat payment ',
						loading: true,
						showFooter: false
					});
					$.ajax({
		                cache: true,
		                type: "POST",
		                url:"{:U('famouns_add_save')}",
		                data:$('#cash_pay_form').serialize(),
		                dataType:"json",
		                success: function(result) {
		                    if(result.status==1){
		                    	qsDialog.setContent("<img src='"+result.data+"' alt=' Scan QR code ' width='250' height='250' />");
								window.setInterval(run, 5000);
		                    }else{
		                    	qsDialog.setContent('<div class="confirm">' + result.msg + '</div>');
								return false;
		                    }
		                }
		            });
				}else{
					if($("#payment_name").val()=='remittance'){
		        		$("#cash_pay_form").removeAttr('target');
		        	}else{
						var url = "{:U('CompanyService/confirm_pay_status')}";
						var qsDialog=$(this).dialog({
							title: ' confirm payment ',
							loading: true,
							border: false,
							yes: function() {
								window.location.href="{:U('CompanyService/order_list')}";
							},
							cancel:function(){
								window.location.href="{:U('CompanyService/order_list')}";
							}
						});
						$.getJSON(url,function(result){
			        		if(result.status == 1){
			        			qsDialog.setContent(result.data.html);
			        			qsDialog.setBtns([' Payment is done ', ' Encounter problems ']);
			        		}else{
			        			disapperTooltip('remind',result.msg);
			        		}
			        	});
			        }
					$("#cash_pay_form").submit();
				}
			});
			
		    function run(){
	            $.getJSON("{:U('check_weixinpay_notify')}",function(result){
	                if(result.status==1){
	                   location.href=result.data;
	                }
	            });
	        }
	    });
		</script>
	</body>
</html>