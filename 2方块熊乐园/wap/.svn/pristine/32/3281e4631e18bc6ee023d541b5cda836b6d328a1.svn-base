<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<include file="public:meta" />
	<link href="../public/css/members/common.css" rel="stylesheet" type="text/css" />
	<script src="../public/js/members/jquery.common.js" type="text/javascript" language="javascript"></script>
</head>
<body>
	<include file="header" />
	<div class="find_pwd">
		<div class="step s1"></div>
		<div class="steptxt">
			<div class="tli font_blue">1. Verify account information </div>
			<div class="tli">2. Set the new password </div>
			<div class="tli">3. Retrieve success </div>
			<div class="clear"></div>
		</div>
		<div class="rl J_focus">
			<div class="td1">
				<div class="input_295_34 select_input J_dropdown J_listitme_parent">
					<span class="J_listitme_text"><if condition="C('qscms_sms_open') eq 1"> Recycle the password by binding the phone <else /> Retrieve the password by registering the mailbox </if></span>
					<div class="dropdowbox1 J_dropdown_menu">
						<div class="dropdow_inner1">
							<ul class="nav_box">
								<if condition="C('qscms_sms_open') eq 1"><li><a class="J_listitme" href="javascript:;" data-code=""> Retrieve your password from your phone </a></li></if>
								<li><a class="J_listitme" href="javascript:;" data-code=""> Retrieve the password by registering the mailbox </a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			<div class="clear"></div>
			<if condition="C('qscms_sms_open') eq 1">
				<div class="mobileshow J_listitme_group">
					<form id="getPassByMobileForm" action="{:U('members/user_getpass')}" method="post" onkeydown="if(event.keyCode==13){return false;}">
						<div class="selecttip"> The system will send a verification code to your phone ， Please pay attention to check </div>
						<div class="J_validate_group">
							<div class="td1">
								<input class="input_295_34" name="mobile" id="mobile" type="text" placeholder=" Please enter phone number "/>
							</div>
							<div class="td2 J_showtip_box"></div>
							<div class="clear"></div>
						</div>
						<div class="J_validate_group">
							<div class="td1">
								<div class="code">
									<input name="mobile_vcode" id="mobile_vcode" type="text"  class="input_295_34" placeholder=" Please enter the SMS verification code "/>
								</div>
								<div class="codebtn">
									<input type="button" class="btn_yellow J_hoverbut" id="J_getverificode" value=" get verification code " />
									<input type="hidden" id="btnCheck" />
								</div>
								<div class="clear"></div>
							</div>
							<div class="td2 J_showtip_box"></div>
							<div class="clear"></div>
						</div>
						<div class="btnbox">
							<input type="hidden" name="token" value="{$token}" />
							<input type="hidden" name="type" value="1" />
							<input type="submit" value=" The next step " class="btn_reg J_hoverbut" />
						</div>
					</form>
				</div>
			</if>
			
			<div class="emailshow J_listitme_group" <if condition="C('qscms_sms_open') eq 0">style="display:block"</if>>
				<form id="getPassByEmailForm" action="{:U('members/user_getpass')}" method="post" onkeydown="if(event.keyCode==13){return false;}">
					<div class="selecttip"> The system will issue a verification email to your registration （ Or bound ） mailbox ，<br> You can reset the password by verifying the message </div>
					<div class="J_validate_group">
						<div class="td1">
							<input class="input_295_34" name="email" id="email" type="text" placeholder="请输入 mailbox "/>
						</div>
						<div class="td2 J_showtip_box"></div>
						<div class="clear"></div>
					</div>
					<div class="btnbox">
						<input type="hidden" name="token" value="{$token}" />
						<input type="hidden" name="type" value="2" />
						<input type="submit" value=" The next step " class="btn_reg J_hoverbut" />
					</div>
				</form>
			</div>
			<div class="bottom_appeal_tip link_blue"><strong> The above methods are not available ？</strong><br />
				 You can still do it  <a href="{:U('Home/Members/appeal_user')}"> Account complaint </a>  or   Telephone contact us  <span class="font_blue">({:C('qscms_bootom_tel')})</span></div>
			</div>
		</div>
		<div id="popup-captcha"></div>
		<input type="hidden" id="J_sms_open" value="{:C('qscms_sms_open')}">
        <input type="hidden" id="J_captcha_open" value="<if condition="C('qscms_captcha_open') eq 1 && C('qscms_captcha_config.varify_mobile') eq 1">1<else/>0</if>" />
		<!--下方阴影 -->
		<div class="find_pwd_bg">
			<div class="bl"></div>
			<div class="br"></div>
			<div class="clear"></div>
		</div>
		<include file="public:footer_min" />
		<script type="text/javascript" src="../public/js/jquery.validate.js"></script>
		<script type="text/javascript" src="../public/js/jquery.listitem.js"></script>
		<script type="text/javascript" src="../public/js/jquery.dropdown.js"></script>
		<script type="text/javascript" src="../public/js/members/jquery.validate.getpass.js"></script>
		<script src="http://static.geetest.com/static/tools/gt.js"></script>
		<script type="text/javascript">
			//  Retrieve the way to switch 
			$('.J_listitme').click(function(event) {
				var indexValue = $('.J_listitme').index(this);
				$('.J_listitme_group').eq(indexValue).show().siblings('.J_listitme_group').hide();
			});
            var captcha_open = eval($('#J_captcha_open').val());
			// 点击 get verification code 先判断是否输入了手机号
			var regularMobile = /^13[0-9]{9}$|14[0-9]{9}$|15[0-9]{9}$|18[0-9]{9}$|17[0-9]{9}$/;
			$('#J_getverificode').click(function() {
				var mobileValue = $.trim($('#mobile').val());
				if (mobileValue == '') {
					disapperTooltip("remind", " Please enter phone number 码");
					$('#mobile').focus();
					return false;
				};
				if (mobileValue != "" && !regularMobile.test(mobileValue)) {
					disapperTooltip("remind", " Please enter the correct phone number ");
					$('#mobile').focus();
					return false;
				}
				$.ajax({
		            url: "{:U('Members/ajax_check')}",
		            cache: false,
		            async: false,
		            type: 'post',
		            dataType: 'json',
		            data: { type: 'mobile', param: mobileValue },
		            success: function(json) {
		                if (json && json.status) {
		                    disapperTooltip("remind", " The phone number is not registered account ");
							$('#mobile').focus();
							return false;
		                } else {
                            if (captcha_open) {
                                $("#btnCheck").click();
                            } else {
                                $.ajax({
                                    url: "{:U('Members/reg_send_sms')}",
                                    type: 'POST',
                                    dataType: 'json',
                                    data: {mobile: $.trim($('#mobile').val()), sms_type: 'getpass'}
                                })
                                .done(function(data) {
                                    if (parseInt(data.status)) {
                                        disapperTooltip("success", " The verification code has been sent ， Please pay attention to check ");
                                        //  Start countdown 
                                        var countdown = 180;
                                        function settime() {
                                            if (countdown == 0) {
                                                $('#J_getverificode').prop("disabled", 0);
                                                $('#J_getverificode').removeClass('btn_disabled');
                                                $('#J_getverificode').val(' get verification code ');
                                                countdown = 180;
                                                return;
                                            } else {
                                                $('#J_getverificode').prop("disabled", !0);
                                                $('#J_getverificode').addClass('btn_disabled');
                                                $('#J_getverificode').val(' Resend ' + countdown + ' second ');
                                                countdown--;
                                            }
                                            setTimeout(function() {
                                                settime()
                                            },1000)
                                        }
                                        settime();
                                    } else {
                                        disapperTooltip("remind", data.msg);
                                    }
                                });
                            }
		                }
		            }
		        });
			});
			if (eval($('#J_sms_open').val())) {
					$.ajax({
			        //  Obtain id，challenge，success（ Whether to enable failback）
			        url: qscms.root+'?m=Home&c=Captcha&t=' + (new Date()).getTime(), //  Plus random number to prevent caching 
			        type: "get",
			        dataType: "json",
			        success: function (data) {
			            //  use initGeetest interface 
			            //  parameter 1：配置 parameter 
			            //  parameter 2： Callback ， Callback 的第一个 parameter 验证码对象，之后可以 use 它做appendTo Such as the event 
			            initGeetest({
			                gt: data.gt,
			                challenge: data.challenge,
			                product: "popup", //  Product form ， include ：float，embed，popup。 Note only right PC Verification code is valid 
			                offline: !data.success //  Indicates whether the user is in the background to check whether the server is down ， Generally do not need attention 
			            }, handler);
			        }
			    });

			    var handler = function(captchaObj) {
					captchaObj.appendTo("#popup-captcha");
					captchaObj.bindOn("#btnCheck");
					captchaObj.onSuccess(function() {
						$.ajax({
							url: "{:U('Members/reg_send_sms')}",
							type: 'POST',
							dataType: 'json',
							data: {mobile: $.trim($('#mobile').val()), sms_type: 'getpass',geetest_challenge: $("input[name='geetest_challenge']").val(),geetest_validate: $("input[name='geetest_validate']").val(),geetest_seccode: $("input[name='geetest_seccode']").val()}
						})
						.done(function(data) {
							if (parseInt(data.status)) {
								disapperTooltip("success", " The verification code has been sent ， Please pay attention to check ");
								//  Start countdown 
								var countdown = 180;
								function settime() {
									if (countdown == 0) {
										$('#J_getverificode').prop("disabled", 0);
										$('#J_getverificode').removeClass('btn_disabled');
										$('#J_getverificode').val(' get verification code ');
										countdown = 180;
										return;
									} else {
										$('#J_getverificode').prop("disabled", !0);
										$('#J_getverificode').addClass('btn_disabled');
										$('#J_getverificode').val(' Resend ' + countdown + ' second ');
										countdown--;
									}
									setTimeout(function() { 
								    	settime()
									},1000)
								}
								settime();
							} else {
								disapperTooltip("remind", data.msg);
							}
						});
					});
					captchaObj.onFail(function() {
						
					});
					captchaObj.onError(function() {
						
					});
					captchaObj.getValidate()
				};
			}
			
		</script>
	</body>
</html>